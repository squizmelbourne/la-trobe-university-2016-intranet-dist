'use strict';

var navUserEl = document.querySelector('.js-nav-user');

var navUserHandler = {
    settings: {
        dataURL: navUserEl.getAttribute('data-userdata-url'),
        builderURL: navUserEl.getAttribute('data-builder-url')
    },
    init: function init() {
        if (!navUserHandler.localStorageExists()) {

            $.get(navUserHandler.settings.dataURL, function (data) {
                // Set localStorage
                localStorage.setItem('user', data);

                navUserHandler.getMarkup(data).then(function (html) {
                    navUserHandler.print(html);
                });
            });
        } else {
            navUserHandler.getMarkup(localStorage.getItem('user')).then(function (html) {
                navUserHandler.print(html);
            });
        }
    },
    localStorageExists: function localStorageExists() {
        return localStorage.getItem('user');
    },
    getMarkup: function getMarkup(rawData) {
        var parsedRawData = JSON.parse(rawData);
        var condensedFlag = navUserEl.classList.contains('nav-user--condensed') ? true : false;
        var notoolsflag = !parsedRawData.businessTools.length && !parsedRawData.tasks.length && !parsedRawData.favourites.length ? true : false;

        return new jQuery.Deferred(function (promise) {
            $.ajax({
                url: navUserHandler.settings.builderURL,
                type: 'get',
                data: {
                    userdata: parsedRawData,
                    notoolsflag: notoolsflag,
                    condensedflag: condensedFlag
                },
                success: function success(response) {
                    return promise.resolve(response);
                }
            });
        });
    },
    print: function print(data) {
        document.querySelector('.js-nav-user').innerHTML = data;
        var mobileSlideoutPlaceholder = document.getElementById('nav-user-slide').querySelector('.nav-user');
        mobileSlideoutPlaceholder.innerHTML = mobileSlideoutPlaceholder.innerHTML + data;
        document.querySelector('body').classList.add('js-nav-user-loaded');
    }
};

(function () {
    if (navUserEl) {
        navUserHandler.init();
    }
})(jQuery);
//# sourceMappingURL=nav-user.min.js.map
