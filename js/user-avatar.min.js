"use strict";function getThumb(e,r){return new Promise(function(t,a){e.getChildren({asset_id:r,levels:1,type_codes:["image"],link_types:["SQ_LINK_NOTICE"],link_values:["thumbnail"],get_attributes:1,dataCallback:function(e){t(e)}})})}function deleteLink(e,r,t,a,n){return new Promise(function(s,i){e.removeLink({parent_id:r,child_id:t,link_type:a,link_value:n,dataCallback:function(e){return s(e)}})})}function trashAsset(e,r){e.trashAsset({asset_ids:r,dataCallback:function(e){console.log(e)}})}function addThumb(e,r,t){return new Promise(function(a,n){e.createLink({parent_id:r,child_id:t,link_type:"SQ_LINK_NOTICE",link_value:"thumbnail",sort_order:1,is_dependant:0,is_exclusive:0,dataCallback:function(e){return a(e)}})})}var userAvatar={settings:{form:"#page_asset_builder_5679",createdImage:"avatar-id",user:"user-id",apiKey:"3187352393",thumbDOM:".nav-user__thumb-img",postSubmitHelper:"#user-avatar-post-submit",redirectPage:"redirect-to",wrapper:".js-edit-profile-image",errorCtrl:"#create-user-avatar-errors",loadingstate:"in-progress"},init:function(){userAvatar.handleSubmission($(document.querySelector(userAvatar.settings.form)))},handleSubmission:function(e){var r={resetForm:!0,success:function(e,r,t){if(userAvatar.hasErrors(t.responseText))userAvatar.setLoading(!1),userAvatar.showErrors(t.responseText);else{var a=$(t.responseText),n=a.find(userAvatar.settings.postSubmitHelper),s=n.data(userAvatar.settings.createdImage),i=n.data(userAvatar.settings.user),o=n.data(userAvatar.settings.redirectPage);userAvatar.initAPI(i,s,o)}},beforeSubmit:function(){userAvatar.setLoading(),userAvatar.clearErrors()}};e.ajaxForm(r)},initAPI:function(e,r,t){var a={},n=void 0;a.key=userAvatar.settings.apiKey,n=new Squiz_Matrix_API(a),getThumb(n,e).then(function(a){if(Array.isArray(a)){var s=a[0].asset_id;deleteLink(n,e,s,"SQ_LINK_NOTICE","thumbnail").then(function(a){console.log(a),userAvatar.addThumbnail(n,e,r).then(function(){userAvatar.redirectTo(t),localStorage.removeItem("user")})}),trashAsset(n,[s])}else userAvatar.addThumbnail(n,e,r).then(function(){userAvatar.redirectTo(t),localStorage.removeItem("user")})})},addThumbnail:function(e,r,t){return new Promise(function(a,n){addThumb(e,r,t).then(function(e){console.log(e),a("Thumbnail added")})})},redirectTo:function(e){window.location.href=e},setLoading:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=document.querySelector(userAvatar.settings.wrapper).classList;e?r.add(userAvatar.settings.loadingstate):r.remove(userAvatar.settings.loadingstate)},hasErrors:function(e){return $(e).find(userAvatar.settings.errorCtrl).length},showErrors:function(e){var r=$(e).find(userAvatar.settings.errorCtrl);r.appendTo(userAvatar.settings.wrapper),window.alert=function(){}},clearErrors:function(){var e=document.querySelector(userAvatar.settings.errorCtrl);e&&e.parentNode.removeChild(e)}};!function(){document.querySelector(userAvatar.settings.form)&&userAvatar.init()}();