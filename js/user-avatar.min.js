"use strict";function getThumb(e,t){return new Promise(function(r,a){e.getChildren({asset_id:t,levels:1,type_codes:["image"],link_types:["SQ_LINK_NOTICE"],link_values:["thumbnail"],get_attributes:1,dataCallback:function(e){r(e)}})})}function deleteLink(e,t,r,a,n){return new Promise(function(i,s){e.removeLink({parent_id:t,child_id:r,link_type:a,link_value:n,dataCallback:function(e){return i(e)}})})}function trashAsset(e,t){e.trashAsset({asset_ids:t,dataCallback:function(e){return e}})}function addThumb(e,t,r){return new Promise(function(a,n){e.createLink({parent_id:t,child_id:r,link_type:"SQ_LINK_NOTICE",link_value:"thumbnail",sort_order:1,is_dependant:0,is_exclusive:0,dataCallback:function(e){return a(e)}})})}var userAvatar={settings:{form:"#page_asset_builder_5679",createdImage:"avatar-id",createdImageURL:"avatar-url",user:"user-id",apiKey:"3187352393",thumbDOM:".nav-user__thumb-img",postSubmitHelper:"#user-avatar-post-submit",submitCtrl:".js-avatar-submit",loadingCtrl:".js-avatar-loading",redirectPage:"redirect-to"},init:function(){userAvatar.handleSubmission($(document.querySelector(userAvatar.settings.form)))},handleSubmission:function(e){var t={success:function(e,t,r){var a=$(r.responseText),n=a.find(userAvatar.settings.postSubmitHelper),i=n.data(userAvatar.settings.createdImage),s=n.data(userAvatar.settings.user),u=n.data(userAvatar.settings.createdImageURL),o=n.data(userAvatar.settings.redirectPage);userAvatar.initAPI(s,i,u,o)},beforeSubmit:function(){document.querySelector(userAvatar.settings.submitCtrl).classList.add("hidden"),document.querySelector(userAvatar.settings.loadingCtrl).classList.remove("hidden")}};e.ajaxForm(t)},initAPI:function(e,t,r,a){var n={},i=void 0;n.key=userAvatar.settings.apiKey,i=new Squiz_Matrix_API(n),getThumb(i,e).then(function(n){if(Array.isArray(n)){var s=n[0].asset_id;deleteLink(i,e,s,"SQ_LINK_NOTICE","thumbnail").then(function(n){console.log(n),userAvatar.addThumbnail(i,e,t,r).then(function(){userAvatar.redirectTo(a)})}),trashAsset(i,[s])}else userAvatar.addThumbnail(i,e,t,r).then(function(){userAvatar.redirectTo(a)})})},addThumbnail:function(e,t,r,a){return new Promise(function(n,i){addThumb(e,t,r).then(function(e){console.log(e),userAvatar.refreshThumbDOM(a),n("DOM refreshed")})})},refreshThumbDOM:function(e){Array.from(document.querySelectorAll(userAvatar.settings.thumbDOM)).forEach(function(t){t.setAttribute("src",e)})},redirectTo:function(e){window.location.href=e}};!function(){document.querySelector(userAvatar.settings.form)&&userAvatar.init()}();