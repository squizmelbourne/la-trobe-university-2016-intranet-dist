"use strict";function getThumb(t,e){return new Promise(function(a,r){t.getChildren({asset_id:e,levels:1,type_codes:["image"],link_types:["SQ_LINK_NOTICE"],link_values:["thumbnail"],get_attributes:1,dataCallback:function(t){a(t)}})})}function deleteLink(t,e,a,r,n){return new Promise(function(i,s){t.removeLink({parent_id:e,child_id:a,link_type:r,link_value:n,dataCallback:function(t){return i(t)}})})}function trashAsset(t,e){t.trashAsset({asset_ids:e,dataCallback:function(t){return t}})}function addThumb(t,e,a){return new Promise(function(r,n){t.createLink({parent_id:e,child_id:a,link_type:"SQ_LINK_NOTICE",link_value:"thumbnail",sort_order:1,is_dependant:0,is_exclusive:0,dataCallback:function(t){return r(t)}})})}var userAvatar={settings:{form:"#page_asset_builder_5679",createdImage:"avatar-id",createdImageURL:"avatar-url",user:"user-id",apiKey:"3187352393",thumbDOM:".nav-user__thumb-img",postSubmitHelper:"#user-avatar-post-submit",submitCtrl:".js-avatar-submit",loadingCtrl:".js-avatar-loading"},init:function(){userAvatar.handleSubmission($(document.querySelector(userAvatar.settings.form)))},handleSubmission:function(t){var e={success:function(t,e,a){var r=$(a.responseText),n=r.find(userAvatar.settings.postSubmitHelper),i=n.data(userAvatar.settings.createdImage),s=n.data(userAvatar.settings.user),u=n.data(userAvatar.settings.createdImageURL);userAvatar.initAPI(s,i,u)},beforeSubmit:function(){document.querySelector(userAvatar.settings.submitCtrl).classList.add("hidden"),document.querySelector(userAvatar.settings.loadingCtrl).classList.remove("hidden")}};t.ajaxForm(e)},initAPI:function(t,e,a){var r={},n=void 0;r.key=userAvatar.settings.apiKey,n=new Squiz_Matrix_API(r),getThumb(n,t).then(function(r){if(Array.isArray(r)){var i=r[0].asset_id;deleteLink(n,t,i,"SQ_LINK_NOTICE","thumbnail").then(function(r){console.log(r),userAvatar.addThumbnail(n,t,e,a)}),trashAsset(n,[i])}else userAvatar.addThumbnail(n,t,e,a)})},addThumbnail:function(t,e,a,r){addThumb(t,e,a).then(function(t){console.log(t),userAvatar.refreshThumbDOM(r)})},refreshThumbDOM:function(t){Array.from(document.querySelectorAll(userAvatar.settings.thumbDOM)).forEach(function(e){e.setAttribute("src",t)})}};!function(){document.querySelector(userAvatar.settings.form)&&userAvatar.init()}();