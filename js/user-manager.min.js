"use strict";function getThumb(e,t){return new Promise(function(n,r){e.getChildren({asset_id:t,levels:1,type_codes:["image"],link_types:["SQ_LINK_NOTICE"],link_values:["thumbnail"],get_attributes:1,dataCallback:function(e){n(e)}})})}function deleteLink(e,t,n,r,a){return new Promise(function(s,i){e.removeLink({parent_id:t,child_id:n,link_type:r,link_value:a,dataCallback:function(e){return s(e)}})})}function trashAsset(e,t){e.trashAsset({asset_ids:t,dataCallback:function(e){console.log(e)}})}function addThumb(e,t,n){return new Promise(function(r,a){e.createLink({parent_id:t,child_id:n,link_type:"SQ_LINK_NOTICE",link_value:"thumbnail",sort_order:1,is_dependant:0,is_exclusive:0,dataCallback:function(e){return r(e)}})})}function getClassListString(e){return Array.from(e).reduce(function(e,t){return e+"."+t},"")}function initNavCondensedAccordion(){var e=!1;$(".js-nav-user__acc-trigger").UberAccordion({buttonClass:"nav-user__acc-toggle",onSelect:function(t,n){e=!e,e?$("body").on("click.navcondensed",function(e){var r=getClassListString(e.target.classList),a=getClassListString(t[0].classList),s=getClassListString(n[0].classList),i=""!==r&&t[0].querySelector(r),o=""!==r&&n[0].querySelector(r);i||o||r===a||r===s||$(t).trigger("click")}):$("body").off("click.navcondensed")}})}var userAvatar={settings:{form:"#page_asset_builder_5679",createdImage:"avatar-id",user:"user-id",apiKey:"3187352393",thumbDOM:".nav-user__thumb-img",postSubmitHelper:"#user-avatar-post-submit",redirectPage:"redirect-to",wrapper:".js-edit-profile-image",errorCtrl:"#create-user-avatar-errors",loadingstate:"in-progress"},init:function(){userAvatar.handleSubmission($(document.querySelector(userAvatar.settings.form)))},handleSubmission:function(e){var t={resetForm:!0,success:function(e,t,n){userAvatar.hasErrors(n.responseText)?(userAvatar.setLoading(!1),userAvatar.showErrors(n.responseText)):!function(){var e=$(n.responseText),t=e.find(userAvatar.settings.postSubmitHelper),r=t.data(userAvatar.settings.createdImage),a=t.data(userAvatar.settings.user),s=t.data(userAvatar.settings.redirectPage),i=$(".js-avatar-submit").attr("data-trigger")+"?uid="+a+"&fid=4948&fval="+r;$.get(i).done(function(){userAvatar.redirectTo(s),$.get("https://intranetdev.latrobe.edu.au/clearusercache")})}()},beforeSubmit:function(){userAvatar.setLoading(),userAvatar.clearErrors()}};e.ajaxForm(t)},initAPI:function(e,t,n){var r={},a=void 0;r.key=userAvatar.settings.apiKey,a=new Squiz_Matrix_API(r),getThumb(a,e).then(function(r){if(Array.isArray(r)){var s=r[0].asset_id;deleteLink(a,e,s,"SQ_LINK_NOTICE","thumbnail").then(function(r){console.log(r),userAvatar.addThumbnail(a,e,t).then(function(){userAvatar.redirectTo(n)})}),trashAsset(a,[s])}else userAvatar.addThumbnail(a,e,t).then(function(){userAvatar.redirectTo(n)})})},addThumbnail:function(e,t,n){return new Promise(function(r,a){addThumb(e,t,n).then(function(e){console.log(e),r("Thumbnail added")})})},redirectTo:function(e){window.location.href=e},setLoading:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=document.querySelector(userAvatar.settings.wrapper).classList;e?t.add(userAvatar.settings.loadingstate):t.remove(userAvatar.settings.loadingstate)},hasErrors:function(e){return $(e).find(userAvatar.settings.errorCtrl).length},showErrors:function(e){var t=$(e).find(userAvatar.settings.errorCtrl);t.appendTo(userAvatar.settings.wrapper),window.alert=function(){}},clearErrors:function(){var e=document.querySelector(userAvatar.settings.errorCtrl);e&&e.parentNode.removeChild(e)}};!function(){document.querySelector(userAvatar.settings.form)&&userAvatar.init()}();var navUserMobileHandler={settings:{toggles:["js-nav-user__mobile-toggle","nav-user__close"],nav:"nav-user",activeClasses:{wrapper:"nav-user__slide-out--active",nav:"nav-user--open"}},init:function(){var e=navUserMobileHandler;e.settings.toggles.forEach(function(t){e.setEventHandlers(document.querySelector("."+t))})},setEventHandlers:function(e){var t=navUserMobileHandler;e&&e.addEventListener("click",function(e){e.preventDefault();var n=document.querySelector(e.currentTarget.getAttribute("data-target")),r=n.querySelector("."+t.settings.nav);t.toggleClass(n,t.settings.activeClasses.wrapper),t.toggleClass(r,t.settings.activeClasses.nav)})},toggleClass:function(e,t){e.classList.toggle(t)}},navUserHandler={settings:{el:"",dataURL:"",currentPage:"",mobiletoggle:!1},init:function(e,t){navUserHandler.settings.el=e,navUserHandler.settings.dataURL=e.getAttribute("data-userdata-url"),navUserHandler.settings.currentPage=e.getAttribute("data-current-page"),navUserHandler.settings.mobiletoggle=!!e.classList.contains("js-nav-user--mobile-toggle"),navUserHandler.toggleLoadingState(e),$.ajax({url:navUserHandler.settings.dataURL,type:"get",data:{condensedflag:!!navUserHandler.settings.el.classList.contains("nav-user--condensed"),mobiletoggle:navUserHandler.settings.mobiletoggle,currentpage:navUserHandler.settings.currentPage},success:function(e){navUserHandler.print(e,t)}})},toggleLoadingState:function(e){var t=e.classList;t.contains("nav-user--condensed")||t.contains("nav-user")&&t.toggle("nav-user--loading")},print:function(e,t){var n=JSON.parse(e),r=document.getElementById("nav-user-slide").querySelector(".nav-user");n.length>1?(r.innerHTML=r.innerHTML+n[0],navUserHandler.settings.el.innerHTML=n[1]):navUserHandler.settings.mobiletoggle?navUserHandler.settings.el.innerHTML=n[0]:(r.innerHTML=r.innerHTML+n[0],navUserHandler.settings.el.innerHTML=n[0]),navUserHandler.toggleLoadingState(navUserHandler.settings.el),t(null)}};!function(){new Promise(function(e,t){navUserHandler.init(document.querySelector(".js-nav-user"),e)}).then(function(){new Promise(function(e,t){navUserHandler.init(document.querySelector(".js-nav-user--mobile-toggle"),e)}).then(function(){document.querySelector("body").classList.add("nav-user-loaded"),initNavCondensedAccordion(),navUserMobileHandler.init()})})}(jQuery);